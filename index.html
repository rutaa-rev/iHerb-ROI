<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>iHerb – AI Agent ROI Calculator</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
  :root {
    --iherb: #3B7D23; --iherb-dark: #2D6119; --iherb-bg: #F0F7EC;
    --iherb-bg2: #E2F0DA; --iherb-bg3: #D0E6C3;
    --white: #FFFFFF;
    --g50: #F9FAFB; --g100: #F3F4F6; --g200: #E5E7EB; --g300: #D1D5DB;
    --g400: #9CA3AF; --g500: #6B7280; --g600: #4B5563; --g700: #374151;
    --g800: #1F2937; --g900: #111827;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Inter', -apple-system, sans-serif; background: var(--white); color: var(--g900); }
  .container { max-width: 1100px; margin: 0 auto; padding: 36px 24px 72px; }

  .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; flex-wrap: wrap; gap: 12px; }
  .header-left { display: flex; align-items: center; gap: 14px; }
  .ada-logo { font-size: 22px; font-weight: 800; color: var(--g800); }
  .pipe { color: var(--g300); font-weight: 300; font-size: 20px; }
  .iherb-logo { font-size: 20px; font-weight: 700; color: var(--iherb); }
  .badge { padding: 5px 14px; border-radius: 6px; font-size: 11px; font-weight: 700; background: var(--iherb); color: white; letter-spacing: 0.8px; text-transform: uppercase; }

  h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.8px; margin-bottom: 4px; }
  .subtitle { font-size: 14px; color: var(--g500); margin-bottom: 28px; }

  .section-title {
    font-size: 15px; font-weight: 700; color: var(--g800); margin-bottom: 12px; margin-top: 32px;
    display: flex; align-items: center; gap: 8px;
  }
  .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--iherb); }

  /* Editable inputs */
  .inputs-grid {
    display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 24px;
  }
  .input-card {
    background: var(--white); border: 1px solid var(--g200); border-radius: 10px; padding: 14px;
    transition: border-color 0.2s, box-shadow 0.2s;
  }
  .input-card:focus-within {
    border-color: var(--iherb); box-shadow: 0 0 0 3px rgba(59,125,35,0.1);
  }
  .input-lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--g400); margin-bottom: 6px; }
  .input-card input {
    width: 100%; border: none; outline: none; font-family: 'Inter', sans-serif;
    font-size: 20px; font-weight: 800; color: var(--g900); background: transparent;
    -moz-appearance: textfield;
  }
  .input-card input::-webkit-outer-spin-button,
  .input-card input::-webkit-inner-spin-button { -webkit-appearance: none; }
  .input-suffix { font-size: 13px; font-weight: 600; color: var(--g400); }

  /* Fixed bar */
  .fixed-bar {
    display: flex; gap: 32px; background: var(--g50); border: 1px solid var(--g200);
    border-radius: 8px; padding: 16px 20px; margin-bottom: 28px; flex-wrap: wrap;
  }
  .fixed-item { display: flex; align-items: center; gap: 8px; }
  .fixed-label { font-size: 11px; font-weight: 600; color: var(--g400); text-transform: uppercase; letter-spacing: 0.4px; }
  .fixed-value { font-size: 15px; font-weight: 700; color: var(--g800); }

  /* Monthly table */
  .table-wrap {
    background: var(--white); border: 1px solid var(--g200);
    border-radius: 10px; overflow: hidden; margin-bottom: 8px;
  }
  table { width: 100%; border-collapse: collapse; }
  thead th {
    padding: 10px 12px; font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: 0.5px; color: var(--g400); background: var(--g50);
    border-bottom: 1px solid var(--g200); text-align: right; white-space: nowrap;
  }
  thead th:first-child { text-align: left; }
  tbody td {
    padding: 10px 12px; font-size: 13px; color: var(--g700);
    border-bottom: 1px solid var(--g100); font-weight: 500; text-align: right;
    font-variant-numeric: tabular-nums;
  }
  tbody td:first-child { text-align: left; color: var(--g600); font-weight: 600; }
  tbody tr:last-child td { border-bottom: none; }
  td.roi-cell { color: var(--iherb); font-weight: 700; }
  tr.total-row td {
    background: var(--iherb-bg) !important; font-weight: 800; color: var(--g900);
    border-top: 2px solid var(--iherb-bg3); font-size: 13px;
  }
  tr.total-row td.roi-cell { color: var(--iherb-dark); }

  /* Savings grid */
  .savings-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 12px;
  }
  .savings-card {
    border-radius: 12px; padding: 24px; border: 1px solid var(--g200);
  }
  .savings-card.actual { background: var(--iherb-bg); border-color: var(--iherb-bg2); }
  .savings-card.projected { background: var(--white); border-color: var(--g200); }
  .savings-card-title {
    font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px;
    margin-bottom: 18px; padding-bottom: 10px; border-bottom: 1px solid rgba(0,0,0,0.08);
  }
  .savings-card.actual .savings-card-title { color: var(--iherb-dark); }
  .savings-card.projected .savings-card-title { color: var(--g500); }
  .savings-row {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.04);
  }
  .savings-row:last-child { border-bottom: none; padding-bottom: 0; }
  .savings-row.highlight { margin-top: 8px; padding-top: 12px; border-top: 2px solid rgba(0,0,0,0.08); border-bottom: none; }
  .sr-label { font-size: 13px; color: var(--g600); font-weight: 500; }
  .sr-value { font-size: 15px; font-weight: 800; color: var(--g900); }
  .sr-value.green { color: var(--iherb); }
  .sr-value.big { font-size: 22px; }

  .footer { text-align: center; margin-top: 48px; padding-top: 24px; border-top: 1px solid var(--g200); }
  .footer p { font-size: 12px; color: var(--g400); }
  .footer a { color: var(--iherb); text-decoration: none; font-weight: 600; }

  @media (max-width: 768px) {
    .inputs-grid { grid-template-columns: repeat(2, 1fr); }
    .savings-grid { grid-template-columns: 1fr; }
    .table-wrap { overflow-x: auto; }
    table { min-width: 600px; }
  }
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="header-left">
      <div class="ada-logo">ada</div>
      <span class="pipe">|</span>
      <span class="iherb-logo">iHerb</span>
    </div>
    <div class="badge">AI Agent ROI</div>
  </div>
  <h1>AI Agent ROI Calculator</h1>
  <p class="subtitle">June 2025 – present · Contract through May 2026 · Editable fields update all calculations in real time</p>

  <!-- Editable Inputs -->
  <div class="section-title"><span class="dot"></span> Performance Metrics (Editable)</div>
  <div class="inputs-grid">
    <div class="input-card">
      <div class="input-lbl">Engaged Conversations</div>
      <input type="number" id="inEngaged" value="1060175" oninput="calc()">
    </div>
    <div class="input-card">
      <div class="input-lbl">Contained Conversations</div>
      <input type="number" id="inContained" value="755729" oninput="calc()">
    </div>
    <div class="input-card">
      <div class="input-lbl">Resolved Conversations</div>
      <input type="number" id="inResolved" value="524385" oninput="calc()">
    </div>
    <div class="input-card">
      <div class="input-lbl">AR Rate</div>
      <div style="display:flex;align-items:baseline;gap:2px;">
        <input type="number" id="inAR" value="49" oninput="calc()" style="width:70px;">
        <span class="input-suffix">%</span>
      </div>
    </div>
    <div class="input-card">
      <div class="input-lbl">Containment Rate</div>
      <div style="display:flex;align-items:baseline;gap:2px;">
        <input type="number" id="inCR" value="71" oninput="calc()" style="width:70px;">
        <span class="input-suffix">%</span>
      </div>
    </div>
  </div>

  <!-- Fixed Inputs -->
  <div class="section-title"><span class="dot"></span> Contract & Cost Parameters</div>
  <div class="fixed-bar">
    <div class="fixed-item">
      <span class="fixed-label">Total Ada Contract (Annual)</span>
      <span class="fixed-value">$413,750</span>
    </div>
    <div class="fixed-item">
      <span class="fixed-label">Monthly Cost</span>
      <span class="fixed-value">$34,479</span>
    </div>
    <div class="fixed-item">
      <span class="fixed-label">Cost Per Ticket (CPC)</span>
      <span class="fixed-value">$2.61</span>
    </div>
  </div>

  <!-- Monthly ROI -->
  <div class="section-title"><span class="dot"></span> Monthly ROI</div>
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th style="text-align:left">Month</th>
          <th>Engaged</th>
          <th>Resolved</th>
          <th>CR%</th>
          <th>AR%</th>
          <th>AHT (min)</th>
          <th>ROI</th>
        </tr>
      </thead>
      <tbody id="monthlyBody"></tbody>
    </table>
  </div>

  <!-- Summary of Savings -->
  <div class="section-title" style="margin-top:36px;"><span class="dot"></span> Summary of Savings</div>
  <div class="savings-grid">
    <div class="savings-card actual" id="savingsActual"></div>
    <div class="savings-card projected" id="savingsProjected"></div>
  </div>

  <!-- FTE Savings -->
  <div class="section-title" style="margin-top:36px;"><span class="dot"></span> Agent FTE Savings</div>
  <div class="savings-grid">
    <div class="savings-card actual" id="fteActual"></div>
    <div class="savings-card projected" id="fteProjected"></div>
  </div>

  <!-- Conversation Utilization -->
  <div class="section-title" style="margin-top:36px;"><span class="dot"></span> Conversation Utilization</div>

  <div class="fixed-bar" style="flex-direction:column; gap:16px;">
    <div style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; color:var(--g400);">Conversations in Contract</div>
    <div style="display:flex; gap:32px; flex-wrap:wrap;">
      <div class="fixed-item">
        <span class="fixed-label">Messaging Conversations</span>
        <span class="fixed-value">1,100,000</span>
      </div>
      <div class="fixed-item">
        <span class="fixed-label">Messaging Swap from Voice</span>
        <span class="fixed-value">192,969</span>
      </div>
      <div class="fixed-item">
        <span class="fixed-label">Total Available till May 2026</span>
        <span class="fixed-value" style="color:var(--iherb);">1,292,969</span>
      </div>
    </div>
  </div>

  <div class="savings-grid" style="margin-top:16px;">
    <div class="savings-card actual" id="utilizationActual"></div>
    <div class="savings-card projected" id="utilizationProjected" style="border-color:var(--iherb-bg2); background:var(--iherb-bg);"></div>
  </div>

  <!-- Utilization Projection Slider -->
  <div class="section-title" style="margin-top:36px;"><span class="dot"></span> Utilization Projection Scenario</div>
  <div style="background:var(--white); border:1px solid var(--g200); border-radius:12px; padding:24px; margin-bottom:16px;">
    <div style="display:flex; justify-content:space-between; align-items:baseline; margin-bottom:10px;">
      <span style="font-size:13px; font-weight:600; color:var(--g600);">Projected Engaged Conversations (Full Term)</span>
      <span id="sliderVal" style="font-size:24px; font-weight:800; color:var(--iherb);"></span>
    </div>
    <input type="range" id="projSlider" min="0" max="2000000" step="5000" value="0" oninput="updateProjection()">
    <div style="display:flex; justify-content:space-between; margin-top:6px;">
      <span id="sliderActualLabel" style="font-size:11px; color:var(--iherb); font-weight:600;"></span>
      <span style="font-size:11px; color:var(--g400);">2,000,000</span>
    </div>
  </div>

  <!-- Chart -->
  <div style="background:var(--white); border:1px solid var(--g200); border-radius:12px; padding:24px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
      <span style="font-size:13px; font-weight:700; color:var(--g800);">Remaining Contract Conversations Over Time</span>
      <span id="chartDepletionLabel" style="font-size:12px; font-weight:600; color:var(--iherb); background:var(--iherb-bg); padding:4px 10px; border-radius:4px;"></span>
    </div>
    <canvas id="projChart" height="220" style="width:100%;"></canvas>
  </div>

  <div class="footer" style="margin-top:48px;">
    <p>Powered by <a href="https://www.ada.cx" target="_blank">ada</a> · Data from Ada Analytics</p>
  </div>
</div>

<script>
var CPC = 2.61;
var ANNUAL_COST = 413750;
var MONTHLY_COST = Math.round(ANNUAL_COST / 12);
var AGENT_HOURS_YEAR = 2080;

// Monthly data from screenshot
var months = [
  { label:"June 2025", engaged:35816, resolved:16192, cont:76, ar:45, aht:442 },
  { label:"July 2025", engaged:94148, resolved:48681, cont:77, ar:52, aht:312 },
  { label:"August 2025", engaged:97917, resolved:46932, cont:71, ar:48, aht:292 },
  { label:"September 2025", engaged:156344, resolved:64534, cont:67, ar:41, aht:455 },
  { label:"October 2025", engaged:144048, resolved:62147, cont:67, ar:43, aht:429 },
  { label:"November 2025", engaged:109906, resolved:52048, cont:68, ar:47, aht:313 },
  { label:"December 2025", engaged:134473, resolved:65040, cont:66, ar:48, aht:407 },
  { label:"January 2026", engaged:186322, resolved:112580, cont:75, ar:60, aht:397 },
  { label:"February 2026", engaged:101201, resolved:56231, cont:74, ar:56, aht:502 }
];

var NUM_MONTHS_ACTUAL = 9; // June 2025 to Feb 2026
var NUM_MONTHS_CONTRACT = 12; // June 2025 to May 2026
var MONTHS_REMAINING = NUM_MONTHS_CONTRACT - NUM_MONTHS_ACTUAL; // Mar, Apr, May = ~3 months left (2 full + partial)

function fmtN(n) { return Math.round(n).toLocaleString('en-US'); }
function fmtD(n) { return '$' + Math.round(n).toLocaleString('en-US'); }

function calc() {
  var engaged = parseFloat(document.getElementById('inEngaged').value) || 0;
  var contained = parseFloat(document.getElementById('inContained').value) || 0;
  var resolved = parseFloat(document.getElementById('inResolved').value) || 0;

  // Monthly table
  var totalResolved = 0, totalEngaged = 0, totalROI = 0;
  var totalContHours = 0, totalContConvos = 0;
  var html = '';

  for (var i = 0; i < months.length; i++) {
    var m = months[i];
    var roi = m.resolved * CPC;
    var contConvos = m.engaged * (m.cont / 100);
    totalResolved += m.resolved;
    totalEngaged += m.engaged;
    totalROI += roi;
    totalContConvos += contConvos;
    totalContHours += contConvos * (m.aht / 3600);

    html += '<tr>';
    html += '<td>' + m.label + '</td>';
    html += '<td>' + fmtN(m.engaged) + '</td>';
    html += '<td>' + fmtN(m.resolved) + '</td>';
    html += '<td>' + m.cont + '%</td>';
    html += '<td>' + m.ar + '%</td>';
    html += '<td>' + (m.aht / 60).toFixed(1) + '</td>';
    html += '<td class="roi-cell">' + fmtD(roi) + '</td>';
    html += '</tr>';
  }

  html += '<tr class="total-row">';
  html += '<td>Total</td>';
  html += '<td>' + fmtN(totalEngaged) + '</td>';
  html += '<td>' + fmtN(totalResolved) + '</td>';
  html += '<td colspan="3"></td>';
  html += '<td class="roi-cell">' + fmtD(totalROI) + '</td>';
  html += '</tr>';

  document.getElementById('monthlyBody').innerHTML = html;

  // Savings calcs — use editable resolved for the main ROI
  var savingsTillDate = resolved * CPC;
  var adaCostTillDate = MONTHLY_COST * NUM_MONTHS_ACTUAL;
  var netTillDate = savingsTillDate - adaCostTillDate;

  // Projection: avg monthly engaged over last 3 months for trend
  var recent3engaged = 0, recent3resolved = 0, recent3contained = 0, recent3hours = 0;
  for (var j = months.length - 3; j < months.length; j++) {
    recent3engaged += months[j].engaged;
    recent3resolved += months[j].resolved;
    var cc = months[j].engaged * (months[j].cont / 100);
    recent3contained += cc;
    recent3hours += cc * (months[j].aht / 3600);
  }
  var avgMonthlyEngaged = recent3engaged / 3;
  var avgMonthlyResolved = recent3resolved / 3;
  var avgMonthlyContained = recent3contained / 3;
  var avgMonthlyHours = recent3hours / 3;

  var projectedEngagedRemaining = avgMonthlyEngaged * MONTHS_REMAINING;
  var projectedResolvedRemaining = avgMonthlyResolved * MONTHS_REMAINING;
  var projectedTotalEngaged = engaged + projectedEngagedRemaining;
  var projectedTotalResolved = resolved + projectedResolvedRemaining;
  var projectedSavings = projectedTotalResolved * CPC;
  var netProjected = projectedSavings - ANNUAL_COST;

  // ROI % and multiplier — till date
  var roiPctTillDate = adaCostTillDate > 0 ? ((savingsTillDate - adaCostTillDate) / adaCostTillDate * 100) : 0;
  var roiMultTillDate = adaCostTillDate > 0 ? (savingsTillDate / adaCostTillDate) : 0;

  // ROI % and multiplier — projected
  var roiPctProjected = ANNUAL_COST > 0 ? ((projectedSavings - ANNUAL_COST) / ANNUAL_COST * 100) : 0;
  var roiMultProjected = ANNUAL_COST > 0 ? (projectedSavings / ANNUAL_COST) : 0;

  // Savings cards
  document.getElementById('savingsActual').innerHTML =
    '<div class="savings-card-title">Savings Till Date (Feb 2026)</div>' +
    '<div class="savings-row"><span class="sr-label">Resolved Conversations</span><span class="sr-value">' + fmtN(resolved) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Resolved × CPC ($2.61)</span><span class="sr-value green">' + fmtD(savingsTillDate) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Cost of Ada (' + NUM_MONTHS_ACTUAL + ' months)</span><span class="sr-value">' + fmtD(adaCostTillDate) + '</span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">Net ROI Till Date</span><span class="sr-value big green">' + fmtD(netTillDate) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">ROI %</span><span class="sr-value green">' + roiPctTillDate.toFixed(0) + '%</span></div>' +
    '<div class="savings-row"><span class="sr-label">ROI Multiple</span><span class="sr-value big green">' + roiMultTillDate.toFixed(1) + 'X</span></div>';

  document.getElementById('savingsProjected').innerHTML =
    '<div class="savings-card-title">Projected Full Contract Term</div>' +
    '<div class="savings-row"><span class="sr-label">Projected Engaged (Full Term)</span><span class="sr-value">' + fmtN(projectedTotalEngaged) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Projected Resolved (Full Term)</span><span class="sr-value">' + fmtN(projectedTotalResolved) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Projected Savings (Resolved × CPC)</span><span class="sr-value green">' + fmtD(projectedSavings) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Total Ada Contract Cost</span><span class="sr-value">' + fmtD(ANNUAL_COST) + '</span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">Projected Net ROI</span><span class="sr-value big green">' + fmtD(netProjected) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">ROI %</span><span class="sr-value green">' + roiPctProjected.toFixed(0) + '%</span></div>' +
    '<div class="savings-row"><span class="sr-label">ROI Multiple</span><span class="sr-value big green">' + roiMultProjected.toFixed(1) + 'X</span></div>';

  // FTE
  var fteTillDate = totalContHours / AGENT_HOURS_YEAR;
  var projectedTotalHours = totalContHours + (avgMonthlyHours * MONTHS_REMAINING);
  var fteProjectedTotal = projectedTotalHours / AGENT_HOURS_YEAR;

  document.getElementById('fteActual').innerHTML =
    '<div class="savings-card-title">FTE Saved Till Date</div>' +
    '<div class="savings-row"><span class="sr-label">Contained Conversations</span><span class="sr-value">' + fmtN(totalContConvos) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Agent Hours Saved</span><span class="sr-value">' + fmtN(totalContHours) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label" style="font-size:11px;color:var(--g400)">Contained Conversations × (AHT ÷ 60)</span><span class="sr-value"></span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">FTE Equivalent Saved</span><span class="sr-value big green">' + fteTillDate.toFixed(1) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label" style="font-size:11px;color:var(--g400)">Based on 2,080 hrs/year per agent</span><span class="sr-value"></span></div>';

  document.getElementById('fteProjected').innerHTML =
    '<div class="savings-card-title">FTE Saved — Projected Full Contract</div>' +
    '<div class="savings-row"><span class="sr-label">Projected Total Agent Hours</span><span class="sr-value">' + fmtN(projectedTotalHours) + '</span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">Projected FTE Equivalent</span><span class="sr-value big green">' + fteProjectedTotal.toFixed(1) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label" style="font-size:11px;color:var(--g400)">Extrapolated from 3-month avg utilization trend</span><span class="sr-value"></span></div>';

  // ---- Conversation Utilization ----
  var TOTAL_CONTRACT_CONVOS = 1292969;
  G_TOTAL_CONTRACT_CONVOS = TOTAL_CONTRACT_CONVOS;
  G_totalEngaged = totalEngaged;
  G_avgMonthlyEngaged = avgMonthlyEngaged;
  var usedConvos = totalEngaged; // engaged convos used till date
  var remainingConvos = TOTAL_CONTRACT_CONVOS - usedConvos;
  var utilizationPct = (usedConvos / TOTAL_CONTRACT_CONVOS) * 100;
  var projectedFullTerm = usedConvos + (avgMonthlyEngaged * MONTHS_REMAINING);
  var projectedUtilPct = (projectedFullTerm / TOTAL_CONTRACT_CONVOS) * 100;

  // Date by which 100% utilization is reached
  // We know usedConvos as of end of Feb 2026, avg monthly rate from last 3 months
  var convosNeeded = TOTAL_CONTRACT_CONVOS - usedConvos;
  var monthsTo100 = avgMonthlyEngaged > 0 ? convosNeeded / avgMonthlyEngaged : 0;

  // Start from March 2026 (month after last data)
  var baseDate = new Date(2026, 2, 1); // March 1, 2026
  var targetDate = new Date(baseDate);
  targetDate.setMonth(targetDate.getMonth() + Math.floor(monthsTo100));
  var fractionalDays = (monthsTo100 - Math.floor(monthsTo100)) * 30;
  targetDate.setDate(targetDate.getDate() + Math.round(fractionalDays));

  var monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  var targetDateStr = monthNames[targetDate.getMonth()] + ' ' + targetDate.getDate() + ', ' + targetDate.getFullYear();

  document.getElementById('utilizationActual').innerHTML =
    '<div class="savings-card-title">Current Utilization</div>' +
    '<div class="savings-row"><span class="sr-label">Engaged Conversations Used</span><span class="sr-value">' + fmtN(usedConvos) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Total Contract Conversations</span><span class="sr-value">' + fmtN(TOTAL_CONTRACT_CONVOS) + '</span></div>' +
    '<div class="savings-row"><span class="sr-label">Remaining</span><span class="sr-value">' + fmtN(remainingConvos) + '</span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">Utilization to Date</span><span class="sr-value big green">' + utilizationPct.toFixed(1) + '%</span></div>';

  document.getElementById('utilizationProjected').innerHTML =
    '<div class="savings-card-title">Projected Utilization & Renewal</div>' +
    '<div class="savings-row"><span class="sr-label">Projected Utilization (End of Contract)</span><span class="sr-value green">' + fmtN(Math.round(projectedFullTerm)) + ' (' + projectedUtilPct.toFixed(0) + '%)</span></div>' +
    '<div class="savings-row"><span class="sr-label">Avg Monthly Engaged (3-mo trend)</span><span class="sr-value">' + fmtN(Math.round(avgMonthlyEngaged)) + '</span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">100% Utilization Reached</span><span class="sr-value big green">' + targetDateStr + '</span></div>' +
    '<div class="savings-row highlight"><span class="sr-label">Proposed Renewal Date</span><span class="sr-value big" style="color:var(--iherb-dark);">' + targetDateStr + '</span></div>';

  // Set slider default to current projection
  var slider = document.getElementById('projSlider');
  var projRounded = Math.round(projectedFullTerm);
  slider.min = projRounded;
  if (!slider._initialized) {
    slider.value = projRounded;
    slider._initialized = true;
  }
  document.getElementById('sliderActualLabel').textContent = 'Current projection: ' + fmtN(projRounded);
  G_projectedFullTerm = projRounded;
  updateProjection();
}

// Global vars needed by updateProjection
var G_totalEngaged = 0;
var G_avgMonthlyEngaged = 0;
var G_TOTAL_CONTRACT_CONVOS = 1292969;
var G_projectedFullTerm = 0;

function updateProjection() {
  var slider = document.getElementById('projSlider');
  var projTotal = parseInt(slider.value);
  document.getElementById('sliderVal').textContent = fmtN(projTotal);

  // Actual used from monthly data
  var actualUsed = 0;
  for (var i = 0; i < months.length; i++) actualUsed += months[i].engaged;

  // Monthly burn for projected remaining period
  var remainingFromSlider = projTotal - actualUsed;
  if (remainingFromSlider < 0) remainingFromSlider = 0;

  // Calculate how many months until all contract convos used
  // We have actualUsed already. Monthly burn going forward:
  var monthlyBurn = remainingFromSlider > 0 ? remainingFromSlider / 3 : G_avgMonthlyEngaged;
  // But if slider > current projection, burn rate is higher
  // monthlyBurn = projected remaining / 3 months (Mar-May)
  // For 100% utilization: how many months from Mar 2026 to exhaust remaining contract convos?
  var contractRemaining = G_TOTAL_CONTRACT_CONVOS - actualUsed;
  var monthsToDepletion = monthlyBurn > 0 ? contractRemaining / monthlyBurn : 999;

  // Build chart data month by month
  var dataPoints = [];
  var labels = [];
  var remaining = G_TOTAL_CONTRACT_CONVOS;

  // Actual months
  for (var i = 0; i < months.length; i++) {
    var shortLabel = months[i].label.split(' ');
    labels.push(shortLabel[0].substring(0, 3) + " '" + shortLabel[1].substring(2));
    remaining -= months[i].engaged;
    if (remaining < 0) remaining = 0;
    dataPoints.push(remaining);
  }

  // Future months from March 2026 onward
  var futureMonths = [
    "Mar '26","Apr '26","May '26","Jun '26","Jul '26","Aug '26",
    "Sep '26","Oct '26","Nov '26","Dec '26","Jan '27","Feb '27",
    "Mar '27","Apr '27","May '27","Jun '27"
  ];
  var fullMonthNames = [
    'March 2026','April 2026','May 2026','June 2026','July 2026','August 2026',
    'September 2026','October 2026','November 2026','December 2026','January 2027','February 2027',
    'March 2027','April 2027','May 2027','June 2027'
  ];

  var depletionMonth = null;
  var depletionFullDate = null;
  for (var j = 0; j < futureMonths.length; j++) {
    var prevRemaining = remaining;
    remaining -= monthlyBurn;
    if (remaining <= 0 && !depletionMonth) {
      // Interpolate the exact day within this month
      var fraction = monthlyBurn > 0 ? prevRemaining / monthlyBurn : 1;
      var dayInMonth = Math.round(fraction * 30);
      if (dayInMonth < 1) dayInMonth = 1;
      if (dayInMonth > 28) dayInMonth = 28;
      // Calculate actual month/year
      var mIdx = (2 + j) % 12; // March = index 2, so 2+0=2(Mar), 2+1=3(Apr)...
      var mYear = 2026 + Math.floor((2 + j) / 12);
      var fullMonthNamesList = ['January','February','March','April','May','June','July','August','September','October','November','December'];
      depletionFullDate = fullMonthNamesList[mIdx] + ' ' + dayInMonth + ', ' + mYear;
      depletionMonth = fullMonthNamesList[mIdx] + ' ' + mYear;
      remaining = 0;
    }
    if (remaining < 0) remaining = 0;
    labels.push(futureMonths[j]);
    dataPoints.push(remaining);
    if (remaining === 0) break;
  }

  if (!depletionFullDate) depletionFullDate = 'Beyond projection range';
  document.getElementById('chartDepletionLabel').textContent = '100% utilization: ' + depletionFullDate;

  drawChart(labels, dataPoints, months.length);
}

function drawChart(labels, data, actualCount) {
  var canvas = document.getElementById('projChart');
  var ctx = canvas.getContext('2d');
  var dpr = window.devicePixelRatio || 1;
  var w = canvas.parentElement.clientWidth - 48;
  var h = 240;
  canvas.width = w * dpr;
  canvas.height = h * dpr;
  canvas.style.width = w + 'px';
  canvas.style.height = h + 'px';
  ctx.scale(dpr, dpr);
  ctx.clearRect(0, 0, w, h);

  var padL = 74, padR = 24, padT = 20, padB = 44;
  var chartW = w - padL - padR;
  var chartH = h - padT - padB;
  var maxVal = Math.max.apply(null, data);
  if (maxVal === 0) maxVal = 1;
  var n = data.length;

  // Grid lines
  ctx.strokeStyle = '#F3F4F6';
  ctx.lineWidth = 1;
  for (var g = 0; g <= 4; g++) {
    var gy = padT + (chartH / 4) * g;
    ctx.beginPath(); ctx.moveTo(padL, gy); ctx.lineTo(padL + chartW, gy); ctx.stroke();
    var yVal = maxVal - (maxVal / 4) * g;
    ctx.fillStyle = '#9CA3AF'; ctx.font = '10px Inter,sans-serif'; ctx.textAlign = 'right';
    ctx.fillText(fmtN(Math.round(yVal)), padL - 8, gy + 4);
  }

  // Divider line between actual and projected
  if (actualCount > 0 && actualCount < n) {
    var divX = padL + (chartW / (n - 1)) * (actualCount - 1);
    ctx.strokeStyle = '#D1D5DB'; ctx.lineWidth = 1; ctx.setLineDash([4, 3]);
    ctx.beginPath(); ctx.moveTo(divX, padT); ctx.lineTo(divX, padT + chartH); ctx.stroke();
    ctx.setLineDash([]);
    ctx.fillStyle = '#9CA3AF'; ctx.font = '9px Inter,sans-serif'; ctx.textAlign = 'center';
    ctx.fillText('Actual | Projected', divX, padT - 6);
  }

  // X labels
  ctx.fillStyle = '#9CA3AF'; ctx.font = '10px Inter,sans-serif'; ctx.textAlign = 'center';
  var step = Math.max(1, Math.floor(n / 12));
  for (var x = 0; x < n; x += step) {
    var xp = padL + (chartW / (n - 1)) * x;
    ctx.fillText(labels[x], xp, h - 8);
  }
  // Always show last label
  if ((n - 1) % step !== 0) {
    var xpLast = padL + chartW;
    ctx.fillText(labels[n - 1], xpLast, h - 8);
  }

  // Area — actual portion
  ctx.beginPath();
  for (var i = 0; i < actualCount && i < n; i++) {
    var px = padL + (chartW / (n - 1)) * i;
    var py = padT + chartH - (data[i] / maxVal) * chartH;
    if (i === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
  }
  var lastActX = padL + (chartW / (n - 1)) * (actualCount - 1);
  ctx.lineTo(lastActX, padT + chartH); ctx.lineTo(padL, padT + chartH); ctx.closePath();
  var grad1 = ctx.createLinearGradient(0, padT, 0, padT + chartH);
  grad1.addColorStop(0, 'rgba(59,125,35,0.18)'); grad1.addColorStop(1, 'rgba(59,125,35,0.02)');
  ctx.fillStyle = grad1; ctx.fill();

  // Area — projected portion
  if (actualCount < n) {
    ctx.beginPath();
    var startI = actualCount - 1;
    for (var i = startI; i < n; i++) {
      var px = padL + (chartW / (n - 1)) * i;
      var py = padT + chartH - (data[i] / maxVal) * chartH;
      if (i === startI) ctx.moveTo(px, py); else ctx.lineTo(px, py);
    }
    var lastProjX = padL + (chartW / (n - 1)) * (n - 1);
    ctx.lineTo(lastProjX, padT + chartH); ctx.lineTo(lastActX, padT + chartH); ctx.closePath();
    var grad2 = ctx.createLinearGradient(0, padT, 0, padT + chartH);
    grad2.addColorStop(0, 'rgba(59,125,35,0.08)'); grad2.addColorStop(1, 'rgba(59,125,35,0.01)');
    ctx.fillStyle = grad2; ctx.fill();
  }

  // Line — actual (solid)
  ctx.beginPath();
  for (var i = 0; i < actualCount && i < n; i++) {
    var px = padL + (chartW / (n - 1)) * i;
    var py = padT + chartH - (data[i] / maxVal) * chartH;
    if (i === 0) ctx.moveTo(px, py); else ctx.lineTo(px, py);
  }
  ctx.strokeStyle = '#3B7D23'; ctx.lineWidth = 2.5; ctx.stroke();

  // Line — projected (dashed)
  if (actualCount < n) {
    ctx.beginPath();
    ctx.setLineDash([6, 4]);
    for (var i = actualCount - 1; i < n; i++) {
      var px = padL + (chartW / (n - 1)) * i;
      var py = padT + chartH - (data[i] / maxVal) * chartH;
      if (i === actualCount - 1) ctx.moveTo(px, py); else ctx.lineTo(px, py);
    }
    ctx.strokeStyle = '#3B7D23'; ctx.lineWidth = 2; ctx.stroke();
    ctx.setLineDash([]);
  }

  // Dots — actual
  for (var i = 0; i < actualCount && i < n; i++) {
    var px = padL + (chartW / (n - 1)) * i;
    var py = padT + chartH - (data[i] / maxVal) * chartH;
    ctx.beginPath(); ctx.arc(px, py, 4, 0, Math.PI * 2); ctx.fillStyle = '#3B7D23'; ctx.fill();
    ctx.beginPath(); ctx.arc(px, py, 2, 0, Math.PI * 2); ctx.fillStyle = '#fff'; ctx.fill();
  }

  // Dots — projected (hollow)
  for (var i = actualCount; i < n; i++) {
    var px = padL + (chartW / (n - 1)) * i;
    var py = padT + chartH - (data[i] / maxVal) * chartH;
    ctx.beginPath(); ctx.arc(px, py, 4, 0, Math.PI * 2);
    ctx.strokeStyle = '#3B7D23'; ctx.lineWidth = 2; ctx.stroke();
    ctx.beginPath(); ctx.arc(px, py, 2, 0, Math.PI * 2); ctx.fillStyle = '#fff'; ctx.fill();
  }

  // Zero label
  if (data[n - 1] === 0) {
    var zx = padL + chartW;
    ctx.fillStyle = '#DC2626'; ctx.font = 'bold 11px Inter,sans-serif'; ctx.textAlign = 'right';
    ctx.fillText('0 remaining', zx - 4, padT + chartH - 8);
  }
}

calc();
</script>
</body>
</html>
